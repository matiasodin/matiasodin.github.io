<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SLC - Plataforma Social de Addons</title>
<style>
  /* Reset */
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: #eee; }
  img { max-width: 100%; border-radius: 6px; }
  button { cursor: pointer; background: #3b82f6; color: white; border: none; padding: 10px 18px; border-radius: 6px; font-weight: 600; transition: background 0.3s ease; }
  button:hover { background: #2563eb; }
  input, textarea { padding: 8px; border-radius: 6px; border: 1px solid #555; background: #222; color: #eee; font-size: 1rem; width: 100%; }
  textarea { resize: vertical; min-height: 70px; }
  a { color: #3b82f6; cursor: pointer; text-decoration: underline; }
  a:hover { color: #60a5fa; }
  
  /* Container */
  #app { max-width: 900px; margin: 20px auto; padding: 20px; background: #1f2937; border-radius: 12px; box-shadow: 0 0 15px rgba(0,0,0,0.7); }

  /* Sections */
  section { display: none; }
  section.active { display: block; animation: fadeIn 0.4s ease forwards; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Welcome */
  #welcome h1 {
    font-size: 2.8rem;
    text-align: center;
    margin-bottom: 30px;
    color: #60a5fa;
  }
  .btn-group {
    display: flex;
    justify-content: center;
    gap: 25px;
  }
  .btn-animated {
    position: relative;
    padding: 14px 30px;
    font-size: 1.3rem;
    font-weight: 700;
    border-radius: 10px;
    overflow: hidden;
    background: linear-gradient(45deg, #3b82f6, #2563eb);
    box-shadow: 0 0 15px #3b82f6;
    color: white;
    user-select: none;
    transition: transform 0.15s ease;
  }
  .btn-animated:hover {
    transform: scale(1.1);
    box-shadow: 0 0 25px #60a5fa;
  }

  /* Forms */
  form {
    max-width: 400px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  label { font-weight: 600; color: #60a5fa; }
  .error-msg {
    color: #f87171;
    font-weight: 600;
    text-align: center;
  }
  .success-msg {
    color: #4ade80;
    font-weight: 600;
    text-align: center;
  }

  /* Menu */
  #menu {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
  }
  #menu button {
    background: #2563eb;
    font-weight: 700;
    padding: 10px 14px;
    border-radius: 8px;
    box-shadow: 0 0 10px #2563eb;
    transition: background 0.3s ease, box-shadow 0.3s ease;
  }
  #menu button:hover {
    background: #1e40af;
    box-shadow: 0 0 20px #60a5fa;
  }

  /* Profile */
  #profile {
    max-width: 600px;
    margin: 0 auto;
  }
  #profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 9999px;
    margin: 0 auto 10px;
    display: block;
    object-fit: cover;
    box-shadow: 0 0 10px #3b82f6;
  }
  #avatar-upload {
    display: block;
    margin: 10px auto 30px;
    color: #60a5fa;
  }
  #addons-list-profile .addon {
    background: #374151;
    padding: 12px 18px;
    border-radius: 12px;
    margin-bottom: 12px;
    position: relative;
  }
  #addons-list-profile .addon strong {
    display: block;
    font-size: 1.2rem;
    margin-bottom: 6px;
    color: #93c5fd;
  }
  #addons-list-profile .addon p {
    margin-bottom: 8px;
  }
  #addons-list-profile .addon button {
    position: absolute;
    top: 12px;
    right: 12px;
    background: #ef4444;
    padding: 6px 12px;
    font-size: 0.9rem;
  }
  #addons-list-profile .addon button.edit-btn {
    right: 60px;
    background: #3b82f6;
  }
  .edit-form {
    margin-top: 10px;
    background: #1e293b;
    padding: 12px;
    border-radius: 10px;
  }
  .edit-form input, .edit-form textarea {
    margin-bottom: 8px;
  }
  .edit-form button {
    width: 48%;
  }
  .edit-form button:first-child {
    margin-right: 4%;
  }

  /* Upload Addon */
  #upload-addon-form {
    max-width: 500px;
    margin: 0 auto;
  }
  #upload-feedback {
    text-align: center;
    margin-top: 10px;
    font-weight: 700;
    color: #4ade80;
  }

  /* Addons List */
  #addons-list-recent, #addons-list-search {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(240px,1fr));
    gap: 16px;
  }
  .addon {
    background: #374151;
    border-radius: 12px;
    padding: 12px;
    box-shadow: 0 0 8px #2563eb;
    position: relative;
  }
  .addon img {
    width: 100%;
    height: 130px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 8px;
  }
  .addon-details strong {
    font-size: 1.2rem;
    color: #93c5fd;
    display: block;
    margin-bottom: 4px;
  }
  .addon-details p {
    font-size: 0.9rem;
    margin-bottom: 6px;
  }
  .like-btn {
    background: #ef4444;
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 6px 10px;
    font-weight: 700;
    border-radius: 8px;
    box-shadow: 0 0 6px #ef4444;
  }
  .like-btn:hover {
    background: #dc2626;
    box-shadow: 0 0 14px #dc2626;
  }

  /* Search */
  #search-bar {
    max-width: 500px;
    margin: 0 auto 20px;
    display: flex;
    gap: 10px;
  }
  #search-bar input {
    flex: 1;
  }

  /* Responsive */
  @media (max-width: 600px) {
    #menu { flex-wrap: wrap; }
    #addons-list-recent, #addons-list-search {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
  <div id="app">

    <!-- Bienvenida -->
    <section id="welcome" class="active">
      <h1>🎉 Bienvenido a <span style="color:#60a5fa">SLC</span> 🎉</h1>
      <div class="btn-group">
        <button id="btn-show-login" class="btn-animated">🔐 Iniciar sesión</button>
        <button id="btn-show-register" class="btn-animated">📝 Registrarse</button>
      </div>
    </section>

    <!-- Login -->
    <section id="login">
      <h2>Iniciar sesión</h2>
      <form id="login-form">
        <label for="login-email">Correo</label>
        <input id="login-email" type="email" required placeholder="tu@email.com" />
        <label for="login-password">Contraseña</label>
        <input id="login-password" type="password" required minlength="6" />
        <div id="login-error" class="error-msg"></div>
        <button type="submit" class="btn-animated">Entrar</button>
      </form>
      <p style="text-align:center; margin-top:10px;">
        ¿No tienes cuenta? <a id="link-to-register">Regístrate aquí</a>
      </p>
      <button id="btn-back-to-welcome" class="btn-animated" style="margin-top:20px;">🔙 Volver</button>
    </section>

    <!-- Registro -->
    <section id="register">
      <h2>Registrarse</h2>
      <form id="register-form">
        <label for="register-email">Correo</label>
        <input id="register-email" type="email" required placeholder="tu@email.com" />
        <label for="register-password">Contraseña</label>
        <input id="register-password" type="password" required minlength="6" />
        <div id="register-error" class="error-msg"></div>
        <button type="submit" class="btn-animated">Crear cuenta</button>
      </form>
      <p style="text-align:center; margin-top:10px;">
        ¿Ya tienes cuenta? <a id="link-to-login">Inicia sesión aquí</a>
      </p>
      <button id="btn-back-to-welcome2" class="btn-animated" style="margin-top:20px;">🔙 Volver</button>
    </section>

    <!-- Menú principal -->
    <nav id="menu" class="hidden" aria-label="Navegación principal">
      <button id="btn-profile">👤 Perfil</button>
      <button id="btn-upload">📤 Subir addon</button>
      <button id="btn-search">🔎 Buscar addon</button>
      <button id="btn-addon-list">📚 Lista de addons</button>
      <button id="btn-discord">💬 Discord</button>
      <button id="btn-logout">🚪 Cerrar sesión</button>
    </nav>

    <!-- Perfil -->
    <section id="profile" class="hidden" aria-label="Perfil de usuario">
      <img id="profile-avatar" src="https://via.placeholder.com/120" alt="Avatar de usuario" />
      <input type="file" id="avatar-upload" accept="image/*,image/gif" title="Cambiar avatar" />
      <h3>Tus addons</h3>
      <div id="addons-list-profile"></div>
    </section>

    <!-- Subir addon -->
    <section id="upload" class="hidden" aria-label="Subir nuevo addon">
      <h2>Subir addon</h2>
      <form id="upload-addon-form">
        <label for="addon-name">Nombre del addon</label>
        <input id="addon-name" type="text" required maxlength="50" />
        <label for="addon-description">Descripción</label>
        <textarea id="addon-description" maxlength="300"></textarea>
        <label for="addon-file">Archivo del addon (.zip, .mcpack...)</label>
        <input id="addon-file" type="file" required />
        <label for="addon-image">Imagen o GIF</label>
        <input id="addon-image" type="file" accept="image/*,image/gif" />
        <button type="submit" class="btn-animated">📤 Subir</button>
        <div id="upload-feedback"></div>
      </form>
    </section>

    <!-- Buscar addon -->
    <section id="search" class="hidden" aria-label="Buscar addons">
      <h2>Buscar addon</h2>
      <div id="search-bar">
        <input id="search-text" type="text" placeholder="Buscar por nombre o autor..." />
        <button id="btn-do-search" class="btn-animated">Buscar</button>
      </div>
      <div id="addons-list-search"></div>
    </section>

    <!-- Lista general de addons -->
    <section id="addonList" class="hidden" aria-label="Lista general de addons">
      <h2>Addons recientes</h2>
      <div id="addons-list-recent"></div>
    </section>

  </div>

<script>
  // --- VARIABLES Y UTILIDADES ---
  const STORAGE_KEYS = { USERS: 'slc_users', SESSION: 'slc_session', ADDONS: 'slc_addons' };
  let session = JSON.parse(localStorage.getItem(STORAGE_KEYS.SESSION)) || null;
  let users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS)) || {};
  let addons = JSON.parse(localStorage.getItem(STORAGE_KEYS.ADDONS)) || [];

  function saveData(key, value) {
    localStorage.setItem(key, JSON.stringify(value));
  }
  function showSection(id) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    const sec = document.getElementById(id);
    if (sec) sec.classList.add('active');
  }
  function showAppUI(show) {
    const menu = document.getElementById('menu');
    if (!menu) return;
    menu.classList.toggle('hidden', !show);
    if (!show) showSection('welcome');
  }

  // --- REGISTRO Y LOGIN ---
  function register(email, password) {
    if (users[email]) return 'Ese correo ya está registrado';
    if (password.length < 6) return 'La contraseña debe tener al menos 6 caracteres';
    users[email] = { email, password, avatar: '', addons: [] };
    saveData(STORAGE_KEYS.USERS, users);
    return null;
  }
  function login(email, password) {
    const user = users[email];
    if (!user) return 'Usuario no encontrado';
    if (user.password !== password) return 'Contraseña incorrecta';
    session = { email };
    saveData(STORAGE_KEYS.SESSION, session);
    return null;
  }
  function logout() {
    session = null;
    saveData(STORAGE_KEYS.SESSION, null);
    showAppUI(false);
  }

  // --- PERFIL ---
  function loadProfile() {
    if (!session) return;
    const user = users[session.email];
    if (!user) return;
    const avatar = document.getElementById('profile-avatar');
    const addonsList = document.getElementById('addons-list-profile');
    avatar.src = user.avatar || 'https://via.placeholder.com/120';
    addonsList.innerHTML = '';
    user.addons.forEach(idx => {
      const addon = addons[idx];
      if (!addon) return;
      const div = document.createElement('div');
      div.className = 'addon';
      div.innerHTML = `
        <strong>${addon.name}</strong>
        <p>${addon.description}</p>
        <button class="edit-btn" onclick="showEditForm(${idx})">✏️ Editar</button>
        <button onclick="deleteAddon(${idx})">🗑️ Eliminar</button>
        <div id="edit-form-${idx}" class="edit-form hidden" style="display:none;">
          <input type="text" id="edit-name-${idx}" value="${addon.name}" maxlength="50" />
          <textarea id="edit-desc-${idx}" maxlength="300">${addon.description}</textarea>
          <button onclick="saveEdit(${idx})">Guardar</button>
          <button onclick="cancelEdit(${idx})">Cancelar</button>
        </div>
      `;
      addonsList.appendChild(div);
    });
  }

  function deleteAddon(index) {
    if (!session) return;
    const user = users[session.email];
    if (!user) return;
    addons.splice(index, 1);
    // Eliminar índice del addon de usuario
    user.addons = user.addons.filter(i => i !== index);
    // Reajustar índices para otros usuarios
    for (const u in users) {
      users[u].addons = users[u].addons.map(i => i > index ? i - 1 : i);
    }
    saveData(STORAGE_KEYS.ADDONS, addons);
    saveData(STORAGE_KEYS.USERS, users);
    loadProfile();
  }

  // Mostrar formulario de edición
  function showEditForm(idx) {
    document.getElementById(`edit-form-${idx}`).style.display = 'block';
  }
  // Cancelar edición
  function cancelEdit(idx) {
    document.getElementById(`edit-form-${idx}`).style.display = 'none';
  }
  // Guardar edición
  function saveEdit(idx) {
    const newName = document.getElementById(`edit-name-${idx}`).value.trim();
    const newDesc = document.getElementById(`edit-desc-${idx}`).value.trim();
    if (newName === '') return alert('El nombre no puede estar vacío');
    addons[idx].name = newName;
    addons[idx].description = newDesc;
    saveData(STORAGE_KEYS.ADDONS, addons);
    cancelEdit(idx);
    loadProfile();
  }

  // Cambiar avatar
  document.getElementById('avatar-upload').addEventListener('change', e => {
    if (!session) return alert('Debes iniciar sesión');
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      users[session.email].avatar = reader.result;
      saveData(STORAGE_KEYS.USERS, users);
      loadProfile();
    };
    reader.readAsDataURL(file);
  });

  // --- SUBIR ADDON ---
  document.getElementById('upload-addon-form').addEventListener('submit', e => {
    e.preventDefault();
    if (!session) return alert('Debes iniciar sesión para subir addons');
    const name = document.getElementById('addon-name').value.trim();
    const description = document.getElementById('addon-description').value.trim();
    const fileInput = document.getElementById('addon-file');
    const imgInput = document.getElementById('addon-image');

    if (!name || !fileInput.files[0]) {
      alert('Nombre y archivo son obligatorios');
      return;
    }

    const readerFile = new FileReader();
    readerFile.onload = () => {
      let imgData = '';
      if (imgInput.files[0]) {
        const readerImg = new FileReader();
        readerImg.onload = () => {
          imgData = readerImg.result;
          saveAddon(name, description, readerFile.result, imgData);
        };
        readerImg.readAsDataURL(imgInput.files[0]);
      } else {
        saveAddon(name, description, readerFile.result, imgData);
      }
    };
    readerFile.readAsDataURL(fileInput.files[0]);
  });

  function saveAddon(name, description, fileData, imgData) {
    const newAddon = {
      name, description, fileData, imgData,
      author: session.email,
      date: new Date().toISOString(),
      likes: 0,
      comments: []
    };
    addons.push(newAddon);
    users[session.email].addons.push(addons.length -1);
    saveData(STORAGE_KEYS.ADDONS, addons);
    saveData(STORAGE_KEYS.USERS, users);
    document.getElementById('upload-addon-form').reset();
    document.getElementById('upload-feedback').textContent = '¡Addon subido con éxito! 🎉';
  }

  // --- BUSCAR ADDON ---
  document.getElementById('btn-do-search').addEventListener('click', () => {
    const text = document.getElementById('search-text').value.trim().toLowerCase();
    const container = document.getElementById('addons-list-search');
    container.innerHTML = '';
    if (!text) return alert('Escribe algo para buscar');
    const results = addons
      .map((addon, i) => ({...addon, index: i}))
      .filter(a => a.name.toLowerCase().includes(text) || a.author.toLowerCase().includes(text));
    if (results.length === 0) {
      container.textContent = 'No se encontraron addons.';
      return;
    }
    results.forEach(addon => {
      const div = document.createElement('div');
      div.className = 'addon';
      div.innerHTML = `
        <img src="${addon.imgData || 'https://via.placeholder.com/240x130'}" alt="Imagen addon" />
        <div class="addon-details">
          <strong>${addon.name}</strong>
          <p>Autor: ${addon.author}</p>
          <p>${addon.description}</p>
          <p>Subido: ${new Date(addon.date).toLocaleDateString()}</p>
        </div>
        <button class="like-btn" onclick="likeAddon(${addon.index})">❤️ ${addon.likes}</button>
      `;
      container.appendChild(div);
    });
  });

  // --- LISTA GENERAL DE ADDONS RECIENTES ---
  function listAddons(id) {
    const container = document.getElementById(id);
    if (!container) return;
    container.innerHTML = '';
    const recent = addons.slice(-12).reverse();
    recent.forEach((addon, i) => {
      const idx = addons.length - 1 - i;
      const div = document.createElement('div');
      div.className = 'addon';
      div.innerHTML = `
        <img src="${addon.imgData || 'https://via.placeholder.com/240x130'}" alt="Imagen addon" />
        <div class="addon-details">
          <strong>${addon.name}</strong>
          <p>Autor: ${addon.author}</p>
          <p>${addon.description}</p>
          <p>Subido: ${new Date(addon.date).toLocaleDateString()}</p>
        </div>
        <button class="like-btn" onclick="likeAddon(${idx})">❤️ ${addon.likes}</button>
      `;
      container.appendChild(div);
    });
  }

  // --- DAR LIKE ---
  function likeAddon(idx) {
    if (!session) return alert('Debes iniciar sesión para dar like');
    addons[idx].likes++;
    saveData(STORAGE_KEYS.ADDONS, addons);
    // Actualizar listas visibles
    listAddons('addons-list-recent');
    document.getElementById('addons-list-search').querySelectorAll('.like-btn').forEach(btn => {
      // Actualizar si está en búsqueda
      if (btn.onclick) btn.onclick();
    });
  }
  window.likeAddon = likeAddon; // Para acceso global

  // --- NAVEGACIÓN ---
  document.getElementById('btn-show-login').onclick = () => {
    showSection('login');
  };
  document.getElementById('btn-show-register').onclick = () => {
    showSection('register');
  };
  document.getElementById('link-to-register').onclick = () => {
    showSection('register');
  };
  document.getElementById('link-to-login').onclick = () => {
    showSection('login');
  };
  document.getElementById('btn-back-to-welcome').onclick = () => {
    showSection('welcome');
  };
  document.getElementById('btn-back-to-welcome2').onclick = () => {
    showSection('welcome');
  };

  // Menú botones
  document.getElementById('btn-profile').onclick = () => {
    showSection('profile');
    loadProfile();
  };
  document.getElementById('btn-upload').onclick = () => {
    showSection('upload');
    document.getElementById('upload-feedback').textContent = '';
  };
  document.getElementById('btn-search').onclick = () => {
    showSection('search');
    document.getElementById('addons-list-search').innerHTML = '';
    document.getElementById('search-text').value = '';
  };
  document.getElementById('btn-addon-list').onclick = () => {
    showSection('addonList');
    listAddons('addons-list-recent');
  };
  document.getElementById('btn-discord').onclick = () => {
    window.open('https://discord.gg/Pm3W6gJunx', '_blank');
  };
  document.getElementById('btn-logout').onclick = () => {
    logout();
  };

  // --- FORMULARIOS ---
  document.getElementById('login-form').addEventListener('submit', e => {
    e.preventDefault();
    const email = e.target['login-email'].value.trim().toLowerCase();
    const password = e.target['login-password'].value;
    const err = login(email, password);
    const errorEl = document.getElementById('login-error');
    if (err) {
      errorEl.textContent = err;
      return;
    }
    errorEl.textContent = '';
    showAppUI(true);
    showSection('addonList');
    listAddons('addons-list-recent');
    loadProfile();
  });

  document.getElementById('register-form').addEventListener('submit', e => {
    e.preventDefault();
    const email = e.target['register-email'].value.trim().toLowerCase();
    const password = e.target['register-password'].value;
    const errorEl = document.getElementById('register-error');
    const err = register(email, password);
    if (err) {
      errorEl.textContent = err;
      return;
    }
    errorEl.textContent = '';
    alert('Registro exitoso! Ahora inicia sesión.');
    showSection('login');
  });

  // --- INICIALIZACIÓN ---
  window.onload = () => {
    if (session && users[session.email]) {
      showAppUI(true);
      showSection('addonList');
      listAddons('addons-list-recent');
      loadProfile();
    } else {
      showAppUI(false);
    }
  };
</script>
</body>
</html>
